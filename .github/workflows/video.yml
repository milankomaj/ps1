name: Video 
on:
  workflow_dispatch:
  
 
jobs:
  build:
    runs-on: ubuntu-latest
    outputs:
      output1: ${{ steps.step1.outputs.SCALE }}
      output2: ${{ steps.step1.outputs.PREFIX }} 
      output3: ${{ steps.step2.outputs.CHECK }}
    timeout-minutes: 10 
    strategy:
      max-parallel: 3
      matrix: 
       prefix: [pir3, pifd, pijp]
  
    steps:
      - uses: actions/checkout@v2     
      - name: himawari video prefix 
        id: step1
        run: | 
         date=$(date +'%Y%m%d')
         echo date=$date
         url=(https://himawari8.nict.go.jp/movie/720/$(echo $date)_${{ matrix.prefix }}.mp4) # pir3.mp4, pifd.mp4, pijp.mp4
         echo url=$url
         size=$(curl -s $url | wc -c)
         echo size=$size
         scale=$(echo "scale=0; $size /1024/1024" | bc -l)
         echo scale=$scale
         echo "::set-output name=SCALE::$(echo $scale)"
         echo "::set-output name=PREFIX::${{ matrix.prefix }}" 

      - name: script
        id: step2
        run: | 
         echo ${{steps.step1.outputs.SCALE}}
         echo ${{steps.step1.outputs.PREFIX}}     
         if [ ${{steps.step1.outputs.SCALE}} -ge 1 ]
         then
         echo '++++'
         echo '::set-output name=CHECK::TRUE'
         echo "${{steps.step2.outputs.CHECK}}"
         else
         echo '-----'
         echo '::set-output name=CHECK::FALSE'
         echo "${{steps.step2.outputs.CHECK}}"
         fi
         echo "${{steps.step2.outputs.CHECK}}" 